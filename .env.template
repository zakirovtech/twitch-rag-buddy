### Секреты witch RUG Buddy (twitch_gateway + ai_chat_brain + redis) ###
# Один общий .env рядом с docker-compose.yml


# OAuth / Twitch App (нужно для common/oauth_local.py и refresh)
# Должен совпасть 1-в-1 с redirect URL в Dev Console
TWITCH_CALLBACK_URL=http://localhost:17563/oauth/twitch/callback

# Client ID/Secret от приложения (Confidential)
TWITCH_APP_CLIENT_ID=PUT_YOUR_CLIENT_ID_HERE
TWITCH_APP_CLIENT_SECRET=PUT_YOUR_CLIENT_SECRET_HERE

# Минимальные права для IRC чата
TWITCH_SCOPES=chat:read chat:edit


########################
# twitch_gateway (IRC)
########################
# Логин бот-аккаунта (владельца токена)
TWITCH_NICK=your_bot_login

# Каналы, куда JOIN (без #), через запятую
TWITCH_CHANNELS=streamer_channel

# Режим с tokens.json (рекомендуется)
# Этот путь — ВНУТРИ контейнера. Должен совпадать с volume mount в compose.
TWITCH_TOKEN_FILE=/app/tokens.json

# Минимальный TTL в секундах: если осталось меньше — refresh
TWITCH_TOKEN_MIN_TTL_SEC=120

# Fallback-режим без tokens.json (можно оставить пустым)
# Формат для IRC: oauth:xxxxxxxxxxxx
TWITCH_OAUTH=


########################
# Redis (шина между gateway и brain)
########################
# Внутри docker network, если сервис называется twitch-redis:
REDIS_URL=redis://twitch-redis:6379/0

# Streams
REDIS_STREAM_IN=twitch:in
REDIS_STREAM_OUT=twitch:out

# Consumer (gateway читает out / пишет in)
REDIS_CONSUMER_GROUP=twitch-gateway
REDIS_CONSUMER_NAME=gateway-1


########################
# Rate limiting (gateway -> Twitch IRC)
########################
RATE_LIMIT_COUNT=20
RATE_LIMIT_WINDOW_SEC=30

# ai_chat_brain (умный чат)
# Ник бота для распознавания @botnick (лучше = TWITCH_NICK)
BOT_NICK=your_bot_login

# Если пусто — brain реагирует на все каналы, которые приходят из gateway
CHANNEL_ALLOWLIST=streamer_channel

# Фильтры
BANWORDS=
MIN_TEXT_LEN=3

# Короткая память
WINDOW_SEC=120
MAX_ITEMS=200
MAX_CONTEXT_MSGS=15

# Авто-говорилка / анти-спам
AUTO_SPEAK_ENABLED=true
BATCH_SEC=15
QUIET_AFTER_SEC=30
BUSY_CHAT_MSGS_10S=8

SPEAK_EVERY_SEC=180
TOPIC_COOLDOWN_SEC=600
MENTION_COOLDOWN_SEC=30
AI_COOLDOWN_SEC=8

MAX_OUT_LEN=350

# Consumer (brain читает in)
REDIS_CONSUMER_GROUP_IN=ai-brain
REDIS_CONSUMER_NAME_IN=brain-1


# Ollama (если в общей сети и сервис/alias = ollama)
OLLAMA_URL=http://ollama:11434
OLLAMA_MODEL=llama3.1:8b
OLLAMA_TEMPERATURE=0.7


# Logs (оба сервиса читают LOG_LEVEL)
LOG_LEVEL=INFO
